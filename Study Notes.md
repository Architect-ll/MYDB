个人学习笔记

# D1.TM

需要学NIO和RandomAccessFile

注意：updateXID()方法同时更新了xid值和对应事务的状态（active;commitied;aborted）

**作用：通过维护 XID 文件来维护事务的状态，并提供接口供其他模块来查询某个事务的状态。**

# D2.DM

```
AbstractCache
```

**引用计算缓存和共享内存数组**

使用引用计算法替换掉了数据库常见的LRU算法

实现原理是定义了三个HashMap（cache, references, getting）其中键为唯一标识。

* cache（键，数据资源）
* references（键，使用当前资源的其它线程或模块数目）
* getting（键，当前资源是否被其它线程占用）

共享内存数组的设计是通过传入统一个数组的引用，通过改变startIndex和endIndex的位置进行实现

**作用：DM 直接管理数据库 DB 文件和日志文件。DM 的主要职责有：1) 分页管理 DB 文件，并进行缓存；2) 管理日志文件，保证在发生错误时可以根据日志进行恢复；3) 抽象 DB 文件为 DataItem 供上层模块使用，并提供缓存。**

# D3.DM

数据页的缓存与管理

不太理解数据库崩溃时<u>recoverInsert()</u>和<u>recoverUpdate()</u>起到的具体作用。

# D4.DM

数据恢复策略

需要mydb.xid和mydb.log文件一起配合

其中mydb.xid标识了事务的具体id以及操作类型（正在进行，已提交，已撤销）

mydb.log文件标识了具体事务操作的数据（[size,cheackSum,data]）

这里最后存储的日志文件具体内容还有待考察

# D5.DM

DataManager（DM）是数据库管理系统中的一层，主要负责底层数据的管理和操作。其功能和作用包括：

1. **数据缓存和管理**：DataManager 实现了对 DataItem 对象的缓存管理，通过缓存管理，可以提高数据的访问效率，并减少对底层存储的频繁访问，从而提高系统的性能。
2. **数据访问和操作**：DataManager 提供了读取、插入和修改等数据操作方法，上层模块可以通过这些方法对数据库中的数据进行操作和管理。
3. **事务管理**：DataManager 支持事务的管理，通过事务管理，可以保证对数据的修改是原子性的，并且在事务提交或回滚时能够保持数据的一致性和完整性。
4. **日志记录和恢复**：DataManager 在数据修改操作前后会执行一系列的流程，包括日志记录和数据恢复等操作，以确保数据的安全性和可靠性，即使在系统崩溃或异常情况下也能够保证数据的完整性。
5. **页面索引管理**：DataManager 中实现了页面索引管理功能，通过页面索引可以快速定位到合适的空闲空间，从而提高数据插入的效率和性能。
6. **文件初始化和校验**：DataManager 在创建和打开数据库文件时，会进行文件的初始化和校验操作，以确保文件的正确性和完整性，同时在文件关闭时会执行相应的清理操作。
7. **资源管理和释放**：DataManager 在关闭时会执行资源的释放和清理操作，包括缓存和日志的关闭，以及页面的释放和页面索引的清理等。

